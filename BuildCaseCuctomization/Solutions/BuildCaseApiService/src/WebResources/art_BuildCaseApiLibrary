var art = art || {};
art.BuildCaseApi = {
    onScriptLoad: function () { },
    callApi: async function (action, inputParamStr) {
        const token = await this.getAccessToken();
        const url = "https://beesmart.iisigroup.com/GU8sGbwY9M42FdBx9tRF/ProjectCreation/" + action;

        const response = await fetch(url, {
            method: "POST",
            body: inputParamStr,
            headers: new Headers({
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            }),
        })
            .then((res) => res.json())
            .catch((error) => {
                console.error("Error:", error);
                console.log("[Error] action:", action);
                console.log("[Error] inputParamStr:", inputParamStr);
                console.log("[Error] token:", token);
                console.log("[Error] url:", url);
            })

        return response;
    },
    getAccessToken: async function () {
        const request = {
            getMetadata: function () {
                return {
                    operationName: "art_GetBuildCaseToken",
                    boundParameter: null,
                    operationType: 0
                }
            }
        }
        const response = await Xrm.WebApi.online.execute(request).then(data => data.json());
        const token = response?.Token ?? "";
        return token;
    }
}